{%- comment -%}
Flat category tree (카드 스타일, 최대 8단계)
각 항목은 아래 섹션(앵커)에서 포스트 목록을 보여줍니다.
{%- endcomment -%}

<style>
/* small styles for the accordion (client-rendered) */
.category-card { margin-bottom: 0.5rem }
.category-tree { list-style: none; padding-left: 0; margin: 0; font-size:0.95em }
.category-tree li { padding: 2px 6px; display:block; line-height:1.15; margin-bottom:2px }
.category-tree .ct-row { display:flex; align-items:center; gap:6px; justify-content:flex-start }
.category-tree .toggle-btn { background:transparent; border:0; cursor:pointer; margin-right:4px; font-size:0.85em; padding:0 4px; width:auto; text-align:center }
.category-tree .ct-row .category-name { display:inline-block }
.category-tree .children, .category-tree .posts { display:none; margin-left: 6px; padding-left: 6px; border-left: 1px solid rgba(0,0,0,0.02) }
.category-tree .open > .children, .category-tree .open > .posts { display:block }
.category-name { cursor: pointer; color:inherit; text-decoration:none; margin-right:6px }
.debug-box { background:#fffbea; border:1px solid #e6db9a; padding:8px; margin-top:12px }
.badge { margin-left: 4px; font-size:0.85em; background:transparent }

/* shrink card body for the tree */
.category-card .card-body { padding-top: 0.5rem; padding-bottom: 0.5rem }
</style>

<div class="card categories mb-3 category-card">
  <div class="card-body p-2">
    <div id="category-tree-root"></div>
  </div>
</div>

<!-- Fallback: server-rendered list (visible if JS fails). JS will hide this on success. -->
<div id="category-fallback" class="card mb-3" style="padding:12px;">
  <strong>Fallback: posts (if JS failed)</strong>
  <ul>
    {%- for p in site.posts -%}
      <li>
        <span style="color:#666">{{ p.categories | join: ' / ' }}</span>
        — <a href="{{ p.url | relative_url }}">{{ p.title }}</a>
      </li>
    {%- endfor -%}
  </ul>
</div>



{%- comment -%} CATEGORY_ITEMS JSON for client-side rendering {%- endcomment -%}
<script id="category-data" type="application/json">
[
{% assign first = true %}
{% for p in site.posts %}
  {% assign cats = p.categories | default: "" %}
  {% if cats and cats != empty %}
    {% unless first %},{% endunless %}
    {% assign first = false %}
    {
      "path": {{ cats | jsonify }},
      "slug": {{ cats | join:'/' | slugify:'raw' | replace:'/','-' | jsonify }},
      "label": {{ cats | last | jsonify }},
      "posts": [
        {
          "title": {{ p.title | jsonify }},
          "url": {{ p.url | relative_url | jsonify }},
          "date": {{ p.date | date: '%Y-%m-%d' | jsonify }}
        }
      ]
    }
  {% endif %}
{% endfor %}
]
</script>








