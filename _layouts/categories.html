---
layout: default
title: Categories
permalink: /categories/
---

<style>
.cat-tree {display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:1rem;}
.cat-card {border:1px solid var(--card-border, #e5e7eb); border-radius:12px; padding:12px;}
.cat-node {display:flex; align-items:center; gap:.4rem; margin:.25rem 0;}
.cat-toggle {all:unset; cursor:pointer; font-weight:600;}
.cat-children {margin-left:1rem; display:none;}
.cat-node.open + .cat-children {display:block;}
.cat-leaf a {text-decoration:none; border-bottom:1px dashed; }
</style>

{% comment %}
1) 모든 포스트의 카테고리 경로를 "||"로 이어붙인 라벨들로 수집
2) 각 라벨의 리프 여부 판정: 자신을 prefix로 가지는 다른 라벨이 없으면 leaf
3) 라벨을 "||"로 split 하여 중첩 UL 렌더
{% endcomment %}

{% assign paths = "" | split: "" %}
{% for p in site.posts %}
  {% assign cats = p.categories | default: "" %}
  {% if cats and cats != empty %}
    {% assign n = cats | size %}
    {% if n > 8 %}{% assign n = 8 %}{% endif %}
    {% assign segs = "" | split: "" %}
    {% for j in (0..n-1) %}
      {% assign segs = segs | push: cats[j] %}
    {% endfor %}
    {% assign label = segs | join: "||" %}
    {% assign paths = paths | push: label %}
  {% endif %}
{% endfor %}

{%- assign uniq_paths = paths | uniq | sort -%}

{%- comment -%} 리프 판정 맵 {%- endcomment -%}
{% assign leaves = "" | split: "" %}
{% for x in uniq_paths %}
  {% assign is_leaf = true %}
  {% for y in uniq_paths %}
    {% if x != y and y startswith x | append: "||" %}
      {% assign is_leaf = false %}
      {% break %}
    {% endif %}
  {% endfor %}
  {% if is_leaf %}{% assign leaves = leaves | push: x %}{% endif %}
{% endfor %}

<div class="cat-tree">
  {% assign roots = "" | split: "" %}
  {% for p in uniq_paths %}
    {% assign root = p | split: "||" | first %}
    {% unless roots contains root %}
      {% assign roots = roots | push: root %}
    {% endunless %}
  {% endfor %}

  {% for root in roots %}
  <div class="cat-card">
    <div class="cat-node cat-toggle">📁 {{ root }}</div>
    <div class="cat-children">
      {% capture subtree %}{% endcapture %}
      {% assign subpaths = "" | split: "" %}
      {% for path in uniq_paths %}
        {% if path == root or path startswith root | append: "||" %}
          {% assign subpaths = subpaths | push: path %}
        {% endif %}
      {% endfor %}

      {%- comment -%} 재귀 없이 단계별로 렌더 {%- endcomment -%}
      {% assign maxd = 8 %}
      {% for d in (2..maxd) %}
        {% for path in subpaths %}
          {% assign parts = path | split: "||" %}
          {% if parts.size == d %}
            {% assign parent = parts | slice: 0, d-1 | join: "||" %}
            {% assign name = parts | last %}
            {% assign this = path %}
            {% assign is_leaf = false %}
            {% if leaves contains this %}{% assign is_leaf = true %}{% endif %}

            <div class="cat-node {% unless is_leaf %}cat-toggle{% endunless %}" data-parent="{{ parent | slugify }}" data-self="{{ this | slugify }}">
              {% if is_leaf %}
                <span>📄</span>
                <span class="cat-leaf">
                  <a href="/categories/{{ this | split: '||' | last | slugify }}/">{{ name }}</a>
                </span>
              {% else %}
                <span>📁</span>
                <span>{{ name }}</span>
              {% endif %}
            </div>
            <div class="cat-children" data-of="{{ this | slugify }}"></div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>

<script>
document.addEventListener('click', (e)=>{
  const t = e.target.closest('.cat-toggle');
  if(!t) return;
  t.classList.toggle('open');
  const sib = t.nextElementSibling;
  if(sib && sib.classList.contains('cat-children')) sib.style.display = sib.style.display==='block'?'none':'block';
});
</script>
